# 파티셔너; Partitioner

- 메시지를 어느 파티션으로 보내야할지 결정할 때 사용
- 프로듀서가 데이터를 보내면 무조건 파티셔너를 통해 브로커로 데이터가 전송됨
- 파티셔너는 레코드에 포함된 메시지 키/값에 따라 어떤 파티션에 저장될지 결정
- 디폴트: UniformStickyPartitioner
  - 메시지 키가 있을 때: 파티셔너에 의해 특정한 해쉬값 생성. 해당 값을 기준으로 어느 파티션에 들어갈지 결정
  - 메시지 키가 없을 때: RR로 파티션에 들어감 (레코드가 아닌 배치 단위로 파티션 결정됨)
- 커스텀 파티셔너를 사용하는 경우
  - 예제: VIP 고객의 데이터를 좀 더 빠르게 처리하고 싶은 경우

### 스티키 파티셔닝

- (RR에서) 토픽에 쌓인 레코드 수가 파티션별 최소 레코드 수보다 적으면 파티션 내에서 계속 대기하는 현상 발생
  - 특정 시간을 초과하면 전송할 수 있도록 설정할 수 있지만 비효율적
- 하나의 파티션에 레코드 수를 먼저 채워서 카프카로 빠르게 배치 전송
- 기존 설정에 비해 30% 이상 지연시간 감소, 프로듀서의 CPU 사용률 ⬇️

<br/>

# 컨슈머 랙; Consumer Lag

- 카프카를 운영함에 있어 아주 중요한 모니터링 지표 중 하나
- 프로듀서가 데이터를 넣어주는 속도가 컨슈머가 데이터를 가져가는 속도보다 빠르게 된다면?
  - lag: 프로듀서가 넣은 오프셋과 컨슈머가 가져간 데이터의 오프셋의 차이
  - 파티션이 여러개 있다면 lag가 여러개 존재 가능
    - 이 중 높은 숫자의 lag를 records-lag-max라고 함
  - 컨슈머가 너무 느리게 동작한다 등 문제가 있으면 lag가 발생할 수 밖에 없음

<br/>

***
참고: inflearn - [데브원영] 아파치 카프카 for beginners
