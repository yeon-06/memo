# 가상 면접 사례로 배우는 대규모 시스템 설계 기초

## Ch01. 사용자 수에 따른 규모 확장성

### 단일 서버
* 가장 단순한 형태의 서버
* 모든 구성 요소가 단 하나의 서버에 담긴 형태

### 서버의 성능 개선하기
* 수직적 규모 확장 (스케일업): 서버에 고사양 자원(ex: CPU, RAM)을 추가하는 행위
* 수평적 규모 확장 (스케일아웃): 더 많은 서버를 추가하는 행위

### 로드밸랜서
* 부하 분산 집합에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할
* 웹 서버 하나가 다운되어도 다른 웹 서버에 트래픽을 전송하면 된다.

### 데이터베이스 다중화
* master-slave 관계 설정
* 데이터 원본은 주(master) 서버, 사본은 부(slave) 서버
* 주 서버는 쓰기 연산 지원을 지원하고 부 서버는 읽기 연산만 지원한다.
* 대부분의 애플리케이션은 쓰기보다는 읽기 연산 비중이 훨씬 높기 때문에.

### 캐시
* 값비싼 연산 결과나 자주 쓰는 데이터를 메모리 안에 두고 뒤이은 요청이 보다 빨리 처리될 수 있도록 하는 저장소
* 고려사항
  * 갱신이 자주 일어나는 데이터인가
  * 어떤 데이터를 캐시에 둬야하는가
  * 어떻게, 언제 만료되는가
  * 일관성은 어떻게 유지되는가
  * 장애에 어떻게 대처할 것인가
  * 캐시 메모리의 크기는 어떻게 잡을 것인가?
  * (캐시가 꽉 찬 경우) 데이터 방출을 어떻게 할 것인가?

### CDN; 컨텐츠 전송 네트워크
* 정적 컨텐츠를 전송하는데 쓰는 지리적으로 분산된 서버의 네트워크
* 요청을 보내는 클라이언트가 한국에 있다면 LA에 있는 원본서버보다 서울에 있는 CDN 서버에 접근해서 데이터를 가져오는 것이 훨씬 빠르다
* 고려사항
  * 비용
  * 적절한 만료 시한 설정
  * 장애 시 대처 방안
  * 컨텐츠 무효화 방법

### 무상태; stateless
* 웹 계층을 수평적으로 확장할 때 상태 정보(ex:사용자 세션)를 고려해야함
* 특정 서버에 세션 데이터를 저장하고 있으면 클라이언트는 해당 서버에만 접근해야함 (고정 세션, sticky session)
* 상태가 없는 무상태 아키텍쳐를 고려해야 함

### 메시지 큐
* 메시지의 무손실을 보장하는 비동기 통신을 지원하는 컴포넌트
* 생산자 또는 발행자는 메시지를 만들어 메시지 큐에 발행(publish)
* 소비자 또는 구독자는 해당 메시지로 적절한 동작 수행
* 서비스/서버 간의 결합을 느슨하게 함

#### 데이터베이스 규모 확장
* 수직적 확장; 스케일 업
  * 더 좋은, 고성능의 자원으로 업그레이드
* 수평적 확장; 샤딩
  * 더 많은 서버 추가
  * 샤딩 전략을 구현할 때 중요한 것은 샤딩키(=파티션 키)
  * 새로운 문제 발생
    * 재샤딩: 데이터가 너무 많아져서 하나의 샤드로 감당이 힘들때, 분포가 균등하지 못할 때
    * 유명인사(핫스팟키) 문제: 특정 샤드에 질의가 집중될 때
    * 조인과 비정규화: 여러 샤드에 걸친 데이터를 조인하기 어려워질 때 -> 비정규화를 통해 하나의 테이블에서 질의가 수행되도록 하면 됨
