9# 가상 면접 사례로 배우는 대규모 시스템 설계 기초

## ch07. 분산 시스템을 위한 유일 ID 생성기 설계

### 유일성이 보장되는 ID 생성

- 다중 마스터 복제
  - DB의 auto_increment 기능 활용
  - k(서버 수)만큼 증가
  - 데이터 센터 확장이 어려워짐
  - ID 값이 시간의 흐름 순으로 생성되지는 않음
  - 서버 추가/삭제 시 잘 동작하도록 만드는 것이 어려움
- UUID
  - 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128bit 수
  - 서버 규모 확장이 쉬움
  - ID가 128bit 길다
  - ID 시간순으로 정렬 불가
  - 숫자가 아닌 값이 포함됨
- 티켓 서버
  - ID 생성을 위한 서버 별도로 구축
  - 구현하기 쉽고 유일성이 보장되는 ID 사용 가능
  - 티켓 서버가 SPOF(Single Point of Failure)가 됨
- 트위터 스노플레이크 접근법
  - ID구조를 여러 절로 분할
  - sign: 나중을 위해 유보. 음수양수 구별하는데 사용 가능
  - timestamp: 현재 시간
  - datacenter id
  - server id
  - 일련번호: 각 서버에서 생성하는 id (1씩 카운트하다 1밀리초가 경과할 때마다 0으로 초기화)

## ch08. URL 단축키 설계

### URL 리디렉션

1. client -> server 단축 url로 API 요청
2. server -> client 상태코드 301 + Location: 원본 url
3. client -> server 원본 url로 API 요청
4. server -> client 응답

### 단축 URL 설계

- 데이터 모델: 간편한 구축을 위해 RDB에 id, shortUrl, longUrl 저장한다고 가정
- 해시 함수: 원래 url을 단축 url로 변환하는데 사용

- 해시 충돌 해소
  - 해시 함수를 사용하면 충돌이 나는 상황이 발생할 수 있음
  - 매번 DB에서 중복되는지 검사하기에는 오버헤드가 큼
  - 블룸 필터를 통해 성능 높일 수 있음

### 추가 공부

- 처리율 제한 장치: 엄청난 양의 url 단축 요청이 들어올 경우에 대비해 처리율 제한 장치를 설계
- 웹 서버의 규모 확장: 본 설계는 무상태 계층이므로 웹 서버의 규모를 확장하기 쉬움
- 데이터베이스 규모 확장: DB 다중화, 샤딩을 통해 규모 확장 달성 가능
- 데이터 분석 솔루션: url 단축기에 데이터 분석 솔루션을 통합해 얼마나 많은 사용자가 클릭했는지 확인 가능
- 가용성, 데이터 일관성, 안전성
