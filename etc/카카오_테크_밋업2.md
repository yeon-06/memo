# 카카오 테크 밋업

### 카카오톡 Java App Server Refactoring 후기 / 이상우
> 참고: https://tech.kakao.com/2023/01/19/kakaotalk-java-app-server-refactoring/ 

가변 Context 클래스는 신중하게 사용하자
- Context: 가변 상태를 가지는 객체
- Context 클래스 간의 의존성
- 가변 Context 참조를 멤버로 가진 클래스
- 가변 Context 참조를 파라미터로 받는 함수

인자로 Context 객체를 그대로 넣기보다는 필요한 것만 명시적으로 받자
- 파라미터가 너무 많아진다면?? -> 함수의 역할을 나누는 것을 검토해야한다
루프 최적화를 위해 캐싱하고 싶다면 Context에 넣지 말고, 루프 밖으로 뺄 수 있는지 보자
- 전역 변수처럼 사용하지 말자는 뜻인듯

고차 함수로 의존성 줄이는 방법
- 순환 의존성 없애기 - Spring 특정 버전 이상부터는 application 띄울 때 자동으로 파악됨
- 함수형 인터페이스를 통해 의존성을 제거한다
    - ServiceA에 있는 메서드에서 ServiceB를 직접 호출하기보다는, 메서드에 인자로 함수형 인터페이스를 넣어서 apply() 등을 호출
    - 단위테스트 작성하기도 훨씬 쉬워짐
    - 함수형인터페이스 도입으로 인해 
    - 디버깅 과정이 더 어려워지지 않나? stacktrace는 잘 뜰 것 같기는한데..
- https://github.com/prostars/ReduceDependency - 아 링크 잘못씀;

코드 복잡도 줄이기; Cyclomatic Complexity, NPath Complexity
- Complexity reducer 0.1.7 플러그인 - 근데 최신 IntelliJ에서는 지원 안함
- 메서드 추출을 통해 복잡성 나누기
- 중첩 조건문을 보호 구문으로 바꾸기 - 아 else 사용 지양 말하는거같다

QnA
* 리팩토링 작업과 신규 요구사항의 우선순위 조정
    * 정답x. 상황에 따라…
* 리팩토링의 중요성 어필
    * 트레이드 오프 설명. 아니면 직접 리팩토링 진행하며 설득하는 수밖에.. 물론 이 코드는 설득에 실패하면 버려질 수 있음
* 리팩토링의 트레이드 오프를 어떤 기준으로 판단하는지
    * 좀 길어도 가독성 좋은 것을 선택
    * ‘빨라보이는 것’은 정확하지 않음. 성능 테스트를 통해 실제로 빠른 코드인지 확인할 필요
* 리팩토링 후 테스트 케이스가 깨진다면?
    * 테스트가 깨지면 리팩토링이 잘못된 것이 아닌지 의심해야함
* 리팩토링의 효과성을 위한 효과적인 지표가 있는가?
    * 성능 개선 != 리팩토링
* SDCF를 사용하는 이유? 장점?
    * 다른 사용하고 있던 기술과 궁합이 좋았음
    * .. 못들었따


### Spring Batch 애플리케이션 성능 향상을 위한 주요 팁 / 김남윤
> 참고: https://if.kakao.com/2022/session/65 

Spring Batch 간략 소개
- 구성요소: JobRepository, JobLauncher, Job, Step, ItemReader, ItemProcessor, ItemWriter 
- Job:Step = N:1, Step:ItemXXX = 1:1
- chunk 프로세싱: chunk만큼 reader & process 동작하는 것을 반복하다가 이후에 전체를 한번에 write 동작

성능 최적화 과정
- ItemProcessor가 느린 원인: I/O 작업
    - 네트워크 I/O 줄이기
        - processor에서 단건 API를 이용해 처리해야만한다고 하면? -> chunk size 만큼 network나 DB 등의 I/O가 발생하니 느려질 수 밖에 없음
        - 벌크성 API로 변경한다면 당연히 좋음! 불가능하다는 가정 하에 진행
        - Processor를 제거하고 Writer에서 진행하게끔 만들 수 있음
        - Writer에서 처리하면 멀티 스레드로 처리 가능
    - DB I/O 줄이기
        - 개별로 update를 chunk만큼 호출해야하면 I/O도 그만큼 발생..
        - in절을 활용해 DB I/O를 줄이도록 개선할 수 있음
        - in절로 처리 불가능하거나.. 여러개의 쿼리를 JDBC execute batch를 통해 한번에 실행하도록 만들 수 있음
- ItemWriter에서 느린 원인: Dirty Checking
    - JPA의 경우 Dirty Checking이 단건으로 일어날 수 있음

QnA
* 대용량 데이터 배치, 병렬 처리하면서 장애 발생 시 어떻게 대응하는가
    * 답이 없다..ㅋㅋㅋ 뭐든 트레이드 오프. 방어 로직을 추가하면 방어 로직을 추가함으로써 뭔가를 잃을 수 있음. 어떤 것을 취하냐에 따라 어떻게 대응할지 다를듯
    * 배치를 계속 돌려도 문제없게끔 만드는 것이 좋다고 생각
* Spring Batch 애플리케이션을 실행시키는 환경
    * 쿠버네티스와 Spring Data Flow?를 활용하고 있음
    * 배치가 200개 넘어서 위와 같이 고가용성 사용하는데.. 엔간하면 Jenkins 사용해도 된다
* 배치 대신 카프카 스트림즈 활용은 어떻게 생각하는지
    * 최대한 사용하려고 하고는 있음
    * 하지만 모두 옮기기엔 도메인적으로 적용하기 힘든 부분이 있음


### 애자일로 개발하면 빨리 끝난다던데? / 김지훈
> https://docs.google.com/presentation/d/1v9_LhXteKj10L2A-cqg4YrWKeUbMek8Fq4qSF8U42WM/edit#slide=id.g259b31d71b2_0_339 

- 업무 전달 중 발생하는 소통 오류 -> 대화 정리
- 중복 업무 처리 -> 업무의 시각화
- 많은 업무가 동시 진행 -> 업무 흐름에 맞는 도구 적용
- 지연되는 일정 -> 일정 관리의 필요성
- 스크럼 해도 완료 못한 일이 계속 남음 -> 스크럼을 잘 지키지 못하는 것이 아닐까?

좋은 팀
- 역량이 뛰어나고
- 동기부여가 된 팀

고민해보면 좋을 포인트
- 우리팀은 어디에서 어떻게 왜 일을 시작할까
- 우리팀의 고객은 누구인가
- 우리팀이 최근에 시도한 것, 잘 되고있는지, 안되었다면 왜?
- 최근에 겪은 변화와 변화의 목적
- 우리팀이 팀으로서 잘하는 것. 아쉬운 부분
- 우리 팀의 가장 최근 회고. 어떤 분위기, 어떤 내용?

QnA
* 애자일로 인해 피로도가 높아지는 경우 애자일 문화를 유지할 수 있을지
    * 애자일보다는 조직의 문제점에 대해 더 초점을 잡고 문제 해결을 위해 애써야할듯
* 애자일의 문제
    * 문제를 작게작게 잘라서 풀어내자..
* 애자일이 버겁다고 느껴진다
    * 처음 접하면 그럴 수 있음. 안정적인 영역을 넓혀가며 익숙해져야하는 것인가?? 안정적인 영역을 넓히기 위해 문제를 작게 잘라서 해결해나가야하나..

